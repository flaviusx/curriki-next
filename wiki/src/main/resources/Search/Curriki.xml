<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
<web>Search</web>
<name>Curriki</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.dward</creator>
<author>XWiki.LudovicDubost</author>
<customClass></customClass>
<contentAuthor>XWiki.LudovicDubost</contentAuthor>
<creationDate>1218150392000</creationDate>
<date>1226669651000</date>
<contentUpdateDate>1226669651000</contentUpdateDate>
<version>45.1</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment>Changed macro names</comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/1.0</syntaxId>
<object>
<class>
<name>XWiki.AssetClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<aggregation_level>
<cache>0</cache>
<customDisplay></customDisplay>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>aggregation_level</name>
<number>4</number>
<picker>1</picker>
<prettyName>Aggregation level</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>choose=Choose from list...|asset=Individual Asset(s)|resource=Learning Resource|lession=Lesson Collection|course=Course/Curriculum</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</aggregation_level>
<alt_desc>
<contenttype>FullyRenderedText</contenttype>
<customDisplay></customDisplay>
<editor>---</editor>
<name>alt_desc</name>
<number>16</number>
<picker>1</picker>
<prettyName>alt_desc</prettyName>
<rows>5</rows>
<size>40</size>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</alt_desc>
<caption_desc>
<contenttype>FullyRenderedText</contenttype>
<customDisplay></customDisplay>
<editor>---</editor>
<name>caption_desc</name>
<number>15</number>
<picker>1</picker>
<prettyName>caption_desc</prettyName>
<rows>5</rows>
<size>40</size>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</caption_desc>
<category>
<cache>0</cache>
<classname></classname>
<customDisplay></customDisplay>
<displayType>select</displayType>
<idField></idField>
<multiSelect>0</multiSelect>
<name>category</name>
<number>10</number>
<picker>1</picker>
<prettyName>category</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators></separators>
<size>1</size>
<sort>none</sort>
<sql>select prop.value from BaseObject as obj, StringProperty as prop where  obj.className='XWiki.MimeTypeClass' and prop.id.id = obj.id  and prop.id.name = 'category' group by prop.value</sql>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<valueField></valueField>
<classType>com.xpn.xwiki.objects.classes.DBListClass</classType>
</category>
<description>
<contenttype>PureText</contenttype>
<customDisplay></customDisplay>
<editor>---</editor>
<name>description</name>
<number>2</number>
<picker>1</picker>
<prettyName>description</prettyName>
<rows>6</rows>
<size>60</size>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<difficulty>
<cache>0</cache>
<customDisplay></customDisplay>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>difficulty</name>
<number>8</number>
<picker>1</picker>
<prettyName>Difficulty</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>choose=Choose from list...|0=Very easy|1=Easy|2=Medium|3=Difficult|4=Very difficult</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</difficulty>
<educational_level>
<cache>0</cache>
<customDisplay></customDisplay>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>educational_level</name>
<number>9</number>
<picker>1</picker>
<prettyName>Educational Level</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>choose=Choose from list...|preschool=Preschool|earlyelementary=Early Elementary|upperelementary=Upper Elementary|middleschool=Middle School|highschool=High School|highered=Higher Ed|professional=Professional|na=NA</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</educational_level>
<educational_level2>
<cache>0</cache>
<customDisplay></customDisplay>
<displayType>checkbox</displayType>
<multiSelect>1</multiSelect>
<name>educational_level2</name>
<number>12</number>
<picker>1</picker>
<prettyName>educational_level2</prettyName>
<relationalStorage>1</relationalStorage>
<separator>#--#</separator>
<separators> ,|</separators>
<size>1</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>prek=Preschool / Ages 0-4|gr-k-2=Gr. K-2 / Ages 5-7|gr-3-5=Gr. 3-5 / Ages 8-10|gr-6-8=Gr. 6-8 / Ages 11-13|gr-9-10=Gr. 9-10 / Ages 14-16|gr-11-12=Gr. 11-12 / Ages 16-18|college_and_beyond=College and Beyond|professional_development=Professional Development|special_education=Special Education|na=Other</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</educational_level2>
<fcdate>
<customDisplay></customDisplay>
<dateFormat>MM/dd/yyyy HH:mm</dateFormat>
<emptyIsToday>0</emptyIsToday>
<name>fcdate</name>
<number>21</number>
<picker>1</picker>
<prettyName>fcdate</prettyName>
<size>20</size>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.DateClass</classType>
</fcdate>
<fcnotes>
<contenttype>FullyRenderedText</contenttype>
<customDisplay></customDisplay>
<editor>PureText</editor>
<name>fcnotes</name>
<number>22</number>
<picker>1</picker>
<prettyName>fcnotes</prettyName>
<rows>10</rows>
<size>80</size>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</fcnotes>
<fcreviewer>
<customDisplay></customDisplay>
<name>fcreviewer</name>
<number>20</number>
<picker>1</picker>
<prettyName>fcreviewer</prettyName>
<size>30</size>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</fcreviewer>
<fcstatus>
<cache>1</cache>
<customDisplay></customDisplay>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>fcstatus</name>
<number>19</number>
<picker>1</picker>
<prettyName>fcstatus</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>0=none|1=ok|2=specialcheck|3=improvementrequested|4=deleted</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</fcstatus>
<fw_items>
<cache>1</cache>
<classname></classname>
<customDisplay></customDisplay>
<displayType>select</displayType>
<idField></idField>
<multiSelect>1</multiSelect>
<name>fw_items</name>
<number>6</number>
<parentField></parentField>
<picker>1</picker>
<prettyName>Framework Items</prettyName>
<relationalStorage>1</relationalStorage>
<separator> </separator>
<separators>|</separators>
<size>10</size>
<sort>none</sort>
<sql>select doc.fullName, doc.title, doc.parent from XWikiDocument as doc, BaseObject as obj where doc.web in ('FW_masterFramework') and doc.fullName=obj.name and obj.className='XWiki.FrameworkItemClass' order by doc.title</sql>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<valueField></valueField>
<classType>com.xpn.xwiki.objects.classes.DBTreeListClass</classType>
</fw_items>
<hidden_from_search>
<customDisplay></customDisplay>
<defaultValue>0</defaultValue>
<displayFormType>checkbox</displayFormType>
<displayType></displayType>
<name>hidden_from_search</name>
<number>18</number>
<prettyName>Hidden from Search</prettyName>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</hidden_from_search>
<instructional_component>
<cache>0</cache>
<customDisplay></customDisplay>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>instructional_component</name>
<number>7</number>
<picker>1</picker>
<prettyName>Instructional Component</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>choose=Choose from list...|activity=Activity|animation=Animation/Simulation|application=Application|assesment=Assessment/Test|audio=Audio/Voice/Song|book=Book|textbook=Book Text Book|course=Course/Curriculum|collection=Collection (of related assets)|diagram=Diagram/Illustration|exercise=Exercise/Problem Set|experiment=Experiment/Lab|graph=Graph/Table|graphic=Graphic/Image|index=Index|image=Image/Photograph|learningobject=Learning Object (SCORM)|lessonplan=Lesson Plan|lecture=Lecture|presentation=Presentation/Slide Show|professionaldevelopment=Professional Development|resourceslist=Resource List/Link(s)|text=Text/Notes/Transcript|video=Video|website=Web Site|worksheet=Worksheet/Graphic Organizer|other=Other</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</instructional_component>
<instructional_component2>
<cache>0</cache>
<customDisplay></customDisplay>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<name>instructional_component2</name>
<number>14</number>
<picker>1</picker>
<prettyName>instructional_component2</prettyName>
<relationalStorage>1</relationalStorage>
<separator>#--#</separator>
<separators> ,|</separators>
<size>5</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>activity_assignment=Activity: Assignment/Homework|activity_exercise=Activity: Exercise|activity_lab=Activity: Experiment/Lab|activity_game=Activity: Game|activity_worksheet=Activity: Graphic Organizer/Worksheet|activity_problemset=Activity: Problem Set|activity_webquest=Activity: WebQuest|book_fiction=Book: Fiction|book_nonfiction=Book: Non-Fiction|book_readings=Book: Readings/Excerpts|book_textbook=Book: Text Book|curriculum_assessment=Curriculum: Assessment/Test|curriculum_course=Curriculum: Full Course|curriculum_unit=Curriculum: Unit|curriculum_lp=Curriculum: Lesson Plan|curriculum_rubric=Curriculum: Rubric|curriculum_scope=Curriculum: Scope &amp; Sequence|curriculum_standards=Curriculum: Standards|curriculum_studyguide=Curriculum: Study Guide/Notes|curriculum_syllabus=Curriculum: Syllabus|curriculum_tutorial=Curriculum: Tutorial|curriculum_workbook=Curriulum: Workbook|resource_animation=Resource: Animation/Simulation|resource_diagram=Resource: Diagram/Illustration|resource_glossary=Resource: Glossary/Vocabulary List|resource_index=Resource: Index/List|resource_photograph=Resource: Photograph|resource_presentation=Resource: Presentation/Slide Show|resource_collection=Resource: Reference Collection|resource_script=Resource: Script/Transcript|resource_speech=Resource: Speech/Lecture/Song|resource_table=Resource: Table/Graph/Chart|resource_template=Resource: Template|resource_webcast=Resource: Webcast/Podcast|other=Other</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</instructional_component2>
<keywords>
<cache>0</cache>
<customDisplay></customDisplay>
<displayType>input</displayType>
<multiSelect>1</multiSelect>
<name>keywords</name>
<number>3</number>
<picker>0</picker>
<prettyName>keywords</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>40</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values></values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</keywords>
<language>
<cache>0</cache>
<customDisplay></customDisplay>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>language</name>
<number>13</number>
<picker>1</picker>
<prettyName>language</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>eng=English|ind=Bahasa Indonesia|zho=Chinese|nld=Dutch|fra=French|deu=German|hin=Hindi|ita=Italian|jpn=Japanese|kor=Korean|nep=Nepali|por=Portuguese|rus=Russian|sin=Sinhalese|spa=Spanish|tam=Tamil|999=Other</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</language>
<rights>
<cache>0</cache>
<customDisplay></customDisplay>
<displayType>radio</displayType>
<multiSelect>0</multiSelect>
<name>rights</name>
<number>11</number>
<picker>1</picker>
<prettyName>Rights</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>public=Public: Available to anyone and any member can edit.|members=Protected: Available to anyone but only you (or your group members) can edit this copy.|private=Private: Only you (or your group members) can view or edit.</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</rights>
<status>
<cache>0</cache>
<customDisplay></customDisplay>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>status</name>
<number>5</number>
<picker>1</picker>
<prettyName>Status</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<sort>none</sort>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values>choose=Choose from list...|draft=Draft|final=Final|revised=Revised</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</status>
<title>
<customDisplay></customDisplay>
<name>title</name>
<number>1</number>
<picker>0</picker>
<prettyName>Title</prettyName>
<size>60</size>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</title>
<tracking>
<customDisplay></customDisplay>
<name>tracking</name>
<number>17</number>
<picker>1</picker>
<prettyName>tracking</prettyName>
<size>30</size>
<tooltip></tooltip>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</tracking>
</class>
<name>Search.Curriki</name>
<number>0</number>
<className>XWiki.AssetClass</className>
</object>
<object>
<class>
<name>XWiki.ExternalAssetClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<link>
<customDisplay></customDisplay>
<name>link</name>
<number>1</number>
<prettyName>external Link</prettyName>
<size>60</size>
<unmodifiable>0</unmodifiable>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</link>
</class>
<name>Search.Curriki</name>
<number>0</number>
<className>XWiki.ExternalAssetClass</className>
</object>
<object>
<class>
<name>XWiki.TagClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<tags>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<name>tags</name>
<number>1</number>
<prettyName>Tags</prettyName>
<relationalStorage>1</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>30</size>
<unmodifiable>0</unmodifiable>
<values></values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</tags>
</class>
<name>Search.Curriki</name>
<number>0</number>
<className>XWiki.TagClass</className>
<property>
<tags/>
</property>
</object>
<content>## vim: ts=4:sw=4
{pre}
## start=0&amp;limit=25&amp;sort=title&amp;dir=ASC
## terms=&amp;subject=&amp;filetype=&amp;level=&amp;language=&amp;ict=&amp;special=
## return  root: results, totalProperty: totalCount
##   pagename, title, ict, contributor, contributorName, review
#set($lucene = $xwiki.getPlugin("lucene"))
#if(!$lucene) ##{
	{'resultCount':'0', 'rows':[]}
#else ## }{
	#if("$!request.lang" != "")##{
		#set($lang = $request.lang)
	#else##}{
		#set($lang = $xwiki.getLanguagePreference())
	#end##}
	#if("$!lang" == "")##{
		#set($lang = "en")
	#end##}
	##
	## Set start and limit for result list
	##
	#set($Integer = 0)
	#set($maxResults = $Integer.parseInt($msg.get('search.results.max')))
	#set($start = 0)
	#if("$!request.start" != "") ##{
		#set($start = $Integer.parseInt($request.start))
	#end ##}
	#set($start = 1 + $start)
	#set($start = "$start")
	#set($limit = "25")
	#if("$!request.limit" != "") ##{
		#set($limit = $request.limit)
	#end ##}
	##
	## Set sort field
	##
	#set($sortField1 = 'title.untokenized')
	#set($sortField2 = 'date')
	#if($!request.sort != "") ##{
		#if($request.sort == "name") ##{
			#set($sortField1 = 'title.untokenized')
			#set($sortField2 = 'date')
		#end ##}
		#if($request.sort == "updated") ##{
			#set($sortField1 = 'date')
			#set($sortField2 = 'title.untokenized')
		#end ##}
	#end ##}
	#if($!request.dir == "DESC") ##{
		#set($sortField1 = "-${sortField1}")
	#end ##}
	#set($sortFields = "${sortField1},${sortField2}")
	#set($sortFields = $sortFields.split(","))
	##
	## Create query
	##
	#set($q = $xwiki.arrayList)
	##
	## Terms
	#if($!request.terms != "") ##{
		#set($junk = $q.add("${request.terms}"))
	#end ##}
	##
	## Put together query conditions
	#set($conditions = "")
	#foreach($condition in $q) ##{
		#set($conditions = "$conditions AND $condition")
	#end ##}
	##
	## General query information
	#set($wikinames = "xwiki")
	#set($languages = "default,en")
## CURRIKI-2572
##  Only fetch things in the default or en language for now, as the $languages
##  parameter does not seem to be working
##  NOTE That this SHOULD try to look for items in the user's language
	#set($include = "web:(Main OR News OR Demo) AND lang:(default OR en)")
	#set($exclude = "AND NOT name:WebPreferences AND NOT web:Blog_Demo AND NOT web:Coll_Demo AND NOT type:attachment AND NOT type:objects")
	#set($luceneQuery = "$include $conditions $exclude")
	##
	## Do query
	##
	#set($searchResults = $lucene.getSearchResults($luceneQuery, $sortFields, $languages))
	#set($results = $searchResults.getResults($start, $limit))
	#set($resultCount = $searchResults.totalHitcount)
	#set($modifiedCount = $resultCount)
	#if($modifiedCount &gt; $maxResults) ##{
	#set($modifiedCount = $maxResults)
	#end ##}

	##
	## List out results
	##
	#if("$!resultCount" == "") ##{
		#set($resultCount = 0)
	#end ##}
	{
	'rows':[
	#set($first = true)
	#foreach($result in $results) ##{
		##
		## Get each result
		#set($d = $xwiki.getDocument("${result.web}.${result.name}"))
		##
		## Get Title
		#asset_findtitle($d)
		#set($title = $currikiTitle)
		#if(!$title || $title.length() == 0) ## {
			#set($title = $msg.get("caption.untitled"))
		#end ## }
		#set($title = $title.replace("'", "&amp;#39;"))
		##
		## Get URL
		#set($url = $xwiki.getURL($d.fullName))
		##
		## Get Content
		#set($text = "")
		#set($text = $!d.getRenderedContent())
		#set($text = $text.replace("'", "&amp;#39;"))
		#set($text = $text.replaceAll("[\n|\r]+", "&lt;br /&gt;"))
		##
		##
		#if($first) ##{
			#set($first = false)
		#else ##} {
			,
		#end ##}
		{
		 'page':'${d.fullName}'
		,'name':'${title}'
##		,'text':'${text}'
		,'updated':'${d.date}'
		,'url':'${url}'
		}
	#end ##}
]
,'resultCount':'${modifiedCount}'
,'totalResults':'${resultCount}'
}
#end ## }
{/pre}</content>
</xwikidoc>
